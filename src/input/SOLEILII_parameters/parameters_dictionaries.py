import numpy as np
from ions import get_omega_i
from scipy.constants import c, e

L_sep = 0.85
# Colliders and oher
# PEPII, KEKB, SuperKEKBI, SuperKEKBII, KEK ATF,EIC,
# 3GLS:
# ALS, APS, SSRF, SPEAR3,SLS,NSLSII,SOLEIL,DIAMOND,ESRF,PLS
# 4GLS
# APS-U,HALF,MAXIV,PETRAIV,SLS2.0,ESRF-EBS
sig_x_dict = {'ALS': 160e-6,
              'ALS-U': np.sqrt(196.5/41.357*76e-12),
              'APS': 276e-6,
              'PLS': 350e-6,
              'SPEAR3': 200e-6,
              'SLS': 111e-6,
              'NSLSII': 122e-6,
              'SSRF': 110e-6,
              'DIAMOND': 7.2e-05,
              'APS-U': np.sqrt(41.68e-12*3.76),
              'DIAMOND II': 1.6e-05,
              'PETRA IV': np.sqrt(50e-12*2304/164.18),
              'MAXIV': np.sqrt(0.326e-9*285/42.2),
              'SLS 2.0': np.sqrt(158e-12*288/39.37),
              'HALF': 15e-6,
              'HEPS': 12.4e-6,
              'ESRF-EBS': np.sqrt(147e-12*844.39/75.6),
              'PEPII': 660e-6,
              'KEKB': 500e-6,
              'AS': 165e-6,
              'KEK ATF': 70e-6,
              'SuperKEKB I': 600e-6,
              'SuperKEKB II': 280e-6,
              'ILC': 120e-6,
              #   'ALS-U':,
              'EIC': np.sqrt(20e-9/18)
              }
color = {'ALS': 'b',
         'ALS-U': 'b',
         'APS': 'g',
         'PLS': 'purple',
         'SPEAR3': 'orange',
         'SLS': 'magenta',
         'NSLSII': 'maroon',
         'SSRF': 'grey',
         'DIAMOND': 'black',
         'APS-U': 'g',
         'DIAMOND II': 'black',
         'PETRA IV': 'blue',
         'MAXIV': 'darkorange',
         'SLS 2.0': 'magenta',
         'HALF': 'red',
         'HEPS': 'darkred',
         'ESRF-EBS': 'navy',
         'PEPII': 'olive',
         'KEKB': 'pink',
         'AS': 'brown',
         'KEK ATF': 'tab:blue',
         'SuperKEKB I': 'tab:orange',
         'SuperKEKB II': 'tab:olive',
         'ILC': 'tab:brown',
         #   'ALS-U':,
         'EIC': 'cyan'}
sig_y_dict = {'ALS': 23e-6,
              'ALS-U': np.sqrt(196.5/20.354*76e-12),
              'APS': 11e-6,
              'PLS': 35e-6,
              'PEPII': 144e-6,
              'KEKB': 75e-6,
              'AS': 14e-6,
              'SSRF': 13e-6,
              'KEK ATF': 5e-6,
              'SPEAR3': 10e-6,
              'SLS': 5.6e-6,
              'NSLSII': 11e-6,
              'SuperKEKB I': 60e-6,
              'SuperKEKB II': 14e-6,
              'ILC': 6e-6,
              # 'PEPX': 5.7e-6,
              'DIAMOND': 2.0e-04,
              'DIAMOND II': 6.3e-06,
              # 'APS_U48': ,
              'APS-U': np.sqrt(41.68e-12*20.59),
              'HALF': 15e-6,
              'ESRF-EBS': np.sqrt(5e-12*844.39/27.6),
              'PETRA IV': np.sqrt(20e-12*2304/68.27),
              'MAXIV': np.sqrt(0.008e-9*285/14.28),
              'HEPS': 5.26e-6,
              #   'ALS-U': ,
              'SLS 2.0': np.sqrt(10e-12*288/15.22),
              'EIC': np.sqrt(4.9e-9/18)
              }
I_dict = {'PEPII': 1550e-3,
          'KEKB': 1200e-3,
          'ALS': 400e-3,
          'ALS-U': 500e-3,
          'APS': 200e-3,
          'PLS': 360e-3,
          'AS': 200e-3,
          'SSRF': 200e-3,
          'KEK ATF': 64e-3,
          'SPEAR3': 500e-3,
          'SLS': 400e-3,
          'NSLSII': 500e-3,
          'SuperKEKB I': 9400e-3,
          'SuperKEKB II': 2600e-3,
          'ILC': 400e-3,
          # 'PEPX': 1500e-3,
          'DIAMOND': 300e-3,
          'DIAMOND II': 300e-3,
          # 'APS_U48': 15.4e-9/1104*c,
          'APS-U': 200e-3,
          'HALF': 500e-3,
          'ESRF-EBS': 200e-3,
          'PETRA IV': 100e-3,#1600e-3*0.125,
          'MAXIV': 500e-3,
          'HEPS': 200e-3,
          #   'ALS-U': ,
          'SLS 2.0': 400e-3,
          'EIC': 5.6e10*3451*e*c/3451
          }
n_b = {'PEPII': 1588,
       'KEKB': 1387,
       'ALS': 320,
       'ALS-U': 328,
       'APS': 324,
       'PLS': 180,
       'AS': 300,
       'SSRF': 450,
       'KEK ATF': 20,
       'SPEAR3': 280,
       'SLS': 390,
       'NSLSII': 1040,
       'SuperKEKB I': 5120,
       'SuperKEKB II': 2500,
       'ILC': 3000,
       # 'PEPX': 3154,
       'DIAMOND': 936,
       'DIAMOND II': 936,
       # 'APS_U48': 48,
       'APS-U': 324,
       'HALF': 800,
       'ESRF-EBS': 992,
       'PETRA IV': 1600,
       'MAXIV': 176,
       'HEPS': 756,
       #    'ALS-U': ,
       'SLS 2.0': 480,
       'EIC': 567}
circumference = {'PEPII': 2199,
                 'KEKB': 3016,
                 'ALS': 196.8,
                 'ALS-U': 196.5,
                 'APS': 1104,
                 'PLS': 280,
                 'AS': 216,
                 'SSRF': 432,
                 'KEK ATF': 138,
                 'SPEAR3': 234,
                 'SLS': 288,
                 'NSLSII': 792,
                 'SuperKEKB I': 3016,
                 'SuperKEKB II': 3016,
                 'ILC': 6000,
                 # 'PEPX': 2199,
                 'DIAMOND': 561.571,
                 'DIAMOND II': 561.571,
                 # 'APS_U48': 1104,
                 'APS-U': 1104,
                 'HALF': 480,
                 'ESRF-EBS': 844.39,
                 'PETRA IV': 2304,
                 'MAXIV': 285,
                 'HEPS': 1360.4,
                 #  'ALS-U': ,
                 'SLS 2.0': 288,
                 'EIC': 3451}
E_kin = {'PEPII': 8e9,
         'KEKB': 8e9,
         'ALS': 1.5e9,
         'ALS-U': 2e9,
         'APS': 7e9,
         'PLS': 2e9,
         'AS': 3e9,
         'SSRF': 3.5e9,
         'KEK ATF': 1.3e9,
         'SPEAR3': 3e9,
         'SLS': 2.4e9,
         'NSLSII': 3e9,
         'SuperKEKB I': 3.5e9,
         'SuperKEKB II': 7e9,
         'ILC': 5e9,
         # 'PEPX': 4.5e9,
         'DIAMOND':  3.5e9,
         'DIAMOND II':  3.5e9,
         # 'APS_U48': 6e9,
         'APS-U': 6e9,
         'HALF': 2.2e9,
         'ESRF-EBS': 6e9,
         'PETRA IV': 6e9,
         'MAXIV': 3e9,
         'HEPS': 6e9,
         #  'ALS-U': ,
         'SLS 2.0': 2.411,
         'EIC': 10e9}
L_sep_dict = {'PEPII': 1.26,
              'KEKB': 2.1,
              'ALS': 0.6,
              'ALS-U': 0.6,
              'APS': 11e-9*c,
              'PLS': 0.6,
              'AS': 0.6,
              'SSRF': 0.6,
              'KEK ATF': 0.77,
              'SPEAR3': 0.63,
              'SLS': 0.6,
              'NSLSII': 0.6,
              'SuperKEKB I': 0.6,
              'SuperKEKB II': 1.18,
              'ILC': 0.5,
              # 'PEPX': 0.6,
              'DIAMOND': 0.6,
              'DIAMOND II': 0.6,
              # 'APS_U48': 77e-9*c ,
              'APS-U': 11e-9*c,
              'HALF': 480/800,
              'ESRF-EBS': 844.39/992,
              'PETRA IV': 2304/1600,
              'MAXIV': 285/176,
              'HEPS': 6e-9*c,
              #   'ALS-U': ,
              'SLS 2.0': 288/480,
              'EIC': 3451/567}


def get_charge_per_bunch(accelerator_name):
    Q = I_dict[accelerator_name] * \
        circumference[accelerator_name]/c/n_b[accelerator_name]
    return Q


omega_i = {}
for acc_name in L_sep_dict.keys():
    omega_i[acc_name] = get_omega_i(sig_x_dict[acc_name], sig_y_dict[acc_name], A=28,
                                    intensity_per_bunch=get_charge_per_bunch(acc_name)/e, L_sep=L_sep_dict[acc_name])[1]
    print('Trapping condition for {:} is {:.1f} < 2'.format(
        acc_name, omega_i[acc_name]*L_sep_dict[acc_name]/c))
print('Roughly speaking anything below 1 is a classical regime where Tavares distribution is applicable. Most operational accelerators only operated in this regime.')
